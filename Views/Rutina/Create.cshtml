@model FitnessManager.ViewModels.RutinaViewModel


<div class="row py-5 text-white justify-content-center">
    <div class="col-md-8">
        <div class="container">
            <form asp-action="Create">
                <div class="card bg-dark text-white">
                    <div class="card-header gradientT1">
                        <h2>Nueva Rutina</h2>
                    </div>
                    <div class="card-body bg-dark text-white">
                        <partial name="_Alert" />
                        <div asp-validation-summary="All" class="text-danger"></div>
                        <div class="form-group">
                            <label asp-for="Rutina.Nombre" class="form-label">Nombre:</label>
                            <input type="text" class="form-control" id="Nombre" asp-for="Rutina.Nombre" required>
                            <span asp-validation-for="Rutina.Nombre" class="text-danger"></span>
                        </div>
                        @* <div class="mb-3">
                            <label asp-for="Rutina.FechaCreacion" class="form-label">Fecha:</label>
                            <input asp-for="Rutina.FechaCreacion" class="form-control" id="FechaCreacion">
                            <span asp-validation-for="Rutina.FechaCreacion" class="text-danger"></span>
                        </div> *@
                        <div class="form-group">
                            <label asp-for="Rutina.Descripcion" class="form-label">Descripcion:</label>
                            <textarea type="text" asp-for="Rutina.Descripcion" class="form-control" style="resize: none;"rows="4"></textarea>
                            <span asp-validation-for="Rutina.Descripcion" class="text-danger"></span>
                        </div>
                        <div class="table-responsive bg-dark border border-dark-subtle rounded-3 p-3 mt-2">
                            <button type="button" class="btn btn-success mb-2 mt-2" onclick="addTr()"><i class="fa-solid fa-plus"></i> Agregar Ejercicio</button>
                            <table class="table table-dark table-striped mt-3">
                                <thead>
                                    <tr>
                                        <th>Ejercicio</th>
                                        <th>Series</th>
                                        <th>Repeticiones</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="Detalles">
                                    <tr>
                                        <td>
                                            <select name="Detalles[0].ExerciseId" asp-for="Detalles[0].ExerciseId" class="form-select" asp-items="ViewBag.Ejercicios">
                                            </select>
                                        </td>
                                        <td>
                                            <input name="Detalles[0].Series" type="number" class="form-control" asp-for="Detalles[0].Series" />
                                        </td>
                                        <td>
                                            <input name="Detalles[0].Repeticiones" type="number" class="form-control" asp-for="Detalles[0].Repeticiones" />
                                        </td>
                                        <td>
                                            <button type="button" class="btn btn-danger" onclick="removeTr(this)">
                                                <i class="fa-solid fa-trash"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="pt-2 card-footer bg-dark">
                        <button type="submit" class="btn btn-edit-gradient"><i class="fa-solid fa-edit me-1"></i>Guardar</button>
                        <a class="btn btn-detail-gradient" asp-action="Index"><i class="fa-solid fa-arrow-left me-1"></i>Volver</a>
                    </div>
                </div>
            </form> 
        </div>
    </div>
</div>

<script>
    let index = document.querySelectorAll("#Detalles tr").length;
    const list = @(ViewData["Ejercicios"] as SelectList).ToJson();

    function addTr() {
        var table = document.querySelector("#Detalles");
        var newRow = document.createElement("tr");

        newRow.innerHTML = `
            <td>
                <select name="Detalles[${index}].ExerciseId" asp-for="Detalles[${index}].ExerciseId" class="form-select">
                    @if (ViewData["Ejercicios"] is SelectList ejercicios)
                    {
                        foreach (var ejercicio in ejercicios)
                        {
                            <text>
                                <option value="@ejercicio.Value">@ejercicio.Text</option>
                            </text>
                        }
                    }
                </select>
            </td>
            <td>
                <input name="Detalles[${index}].Series" type="number" class="form-control" asp-for="Detalles[${index}].Series" />
            </td>
            <td>
                <input name="Detalles[${index}].Repeticiones" type="number" class="form-control" asp-for="Detalles[${index}].Repeticiones" />
            </td>
            <td>
                <button type="button" class="btn btn-danger" onclick="removeTr(this)">
                    <i class="fa-solid fa-trash"></i>
                </button>
            </td>
        `;

        table.appendChild(newRow);

        index++;
    }

    function removeTr(button) {
        var row = button.closest("tr");
        row.remove();
        // NO modificar index
    }
</script>